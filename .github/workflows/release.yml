
name: 'RELEASE'

permissions:
  contents: write

on:
  release:
    types: [published]

jobs:
  upload-to-gh:
    name: Upload to GitHub release
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repo
      uses: actions/checkout@v2
    - name: Release with HEMTT - MultiTheFranky
      uses: MultiTheFranky/action-release-with-hemtt@0.0.5
      id: build
    - name: Upload asset
      uses: shogo82148/actions-upload-release-asset@v1
      with: 
        upload_url: ${{ github.event.release.upload_url }}
        asset_path: ${{ steps.build.outputs.zip_path }}
        asset_content_type: application/zip
    - name: Setup steamcmd
      id: steamcmd
      uses: CyberAndrii/setup-steamcmd@v1

    - name: Create config folder
      run: mkdir -p ${{ steps.steamcmd.outputs.directory }}/config

    - name: Copy config
      run: mv -v config.vdf ${{ steps.steamcmd.outputs.directory }}/config/config.vdf
      
    - name: Copy sentry file
      run: mv -v ssfn* ${{ steps.steamcmd.outputs.directory }}

    - name: Unzip builded mod
      run: unzip -o ${{ steps.build.outputs.zip_path }} -d ${{ steps.build.outputs.release_path }}

    - name: Upload mod
      uses: MultiTheFranky/action-release-to-steam-ws@0.0.1
      with:
        steamcmd_path: ${{ steps.steamcmd.outputs.directory }}
        file_id: '2945336678'
        username: "${{ secrets.STEAM_USERNAME }}"
        password: "${{ secrets.STEAM_PASSWORD }}"
        path: "${{ steps.build.outputs.release_path }}/@${{ steps.build.outputs.mod_name }}"
        name: "${{ steps.build.outputs.mod_name }}"
        change_notes_title: "${{ github.event.release.name }}"
        change_notes: "${{ github.event.release.body }}"